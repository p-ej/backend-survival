# Hexagonal Architecture


### Hexagonal Architecture이란
- 전통적인 계층형 아키텍처의 단점을 보완하기 위해 생긴것
- SOLID 원칙을 바탕으로 어떠한 설계를 해나가야겠다가 바로 Hexagonal Architecture이다.
- 포트 및 어댑터 또는 Onion 아키텍처라고도 하는 육각형 아키텍처는 핵심 애플리케이션 로직을 외부 종속성 및 인프라 문제에서 분리하여 모듈식의 유연한 설계를 촉진하는 소프트웨어 아키텍처 패턴으로 정의한다.
- 궁극적인 목적은 `테스트, 유지 관리 및 발전하기 쉬운 소프트웨어 시스템을 만드는 것`

![사진] (./../../resources/images/헥사고날.png)

#### 특징
- 헥사고날 아키텍처의 핵심은 애플리케이션의 도메인이라고도 하는 핵심 비즈니스 로직을 아키텍처의 중심에 배치하는 것이다. 
- 또 도메인은 사용자 인터페이스, 데이터베이스, 타사 서비스 및 기타 인프라 구성 요소와 같은 외부와의 상호 작용을 처리하는 포트 및 어댑터로 둘러싸여 있다.
- 이렇게 구성하면 도메인이 특정 프레임워크, 라이브러리 또는 외부 시스템과 독립적이게 될 수 있다는 것.


#### 구성요소와 원리
- 이를 여러가지 틀로 나누어보자면 아래와 같다.
1. 코어 도메인
  - 애플리케이션의 비즈니스 로직과 엔터티를 나타낸다. 
  - 시스템의 목적과 가치를 정의하는 필수 기능과 규칙을 캡슐화한다. 
  - 핵심 도메인은 기술에 구애받지 않고 외부 종속성과 무관해야 한다.

2. 포트
  - 코어 도메인이 외부 세계와 통신하는 인터페이스 또는 접근을 정의한다. 
  - 애플리케이션이 지원하는 특정 역할 또는 사용 사례를 나타낸다. 
  - 포트의 예로는 요청을 수신하기 위한 입력 포트와 응답을 전달하거나 이벤트를 게시하기 위한 출력 포트가 있다.

3. 어댑터
  - 포트를 구현하고 코어 도메인과 외부 종속성 사이의 간격을 연결하는 역할을 한다. 
  - 필요한 통합 지점을 제공하고 외부 시스템과의 상호 작용을 처리한다. 
  - 어댑터에는 컨트롤러, 프리젠터, 게이트웨이, 리포지토리 및 핵심 도메인과 외부 와의 통신을 용이하게 하는 기타 구성 요소가 포함될 수 있다.

4. 종속성 역전 원칙
  - 상위 수준 모듈(코어 도메인)이 하위 수준 모듈(어댑터 또는 인프라)에 의존해서는 안 된다는 종속성 역전 원칙을 따른다.
  - 대신 둘 다 추상화(포트)에 의존하여 느슨한 결합과 변경 용이성이 원활해야한다.

5. 테스트 가능성 및 유지 관리 가능성
  - 핵심 도메인을 외부 종속성에서 분리하여 테스트 가능성을 향상시킨다. 
  - 이를 통해 인프라 구성 요소 없이도 핵심 도메인 논리의 단위 테스트가 가능하다. 
  - 또한 Hexagonal Architecture의 모듈식 및 분리형 특성은 외부 구성 요소에 영향을 주지 않고 핵심 도메인을 변경할 수 있으므로 유지 관리 및 변경을 단순화한다.

6. 유연성 및 적응성
  - 육각형 구조로 외부 부품을 쉽게 교체하거나 수정할 수 있다. 
  - 어댑터가 지정된 포트를 준수하는 한 코어 도메인에 영향을 주지 않고 다른 구현을 교환할 수 있다. 
  - 이것은 기술 스택 또는 외부 시스템의 변화에 대한 유연성과 적응성을 가능하게 한다.

#### 계층 구성
- 어댑터 계층
  - 가장 바깥쪽에 있는 계층으로 애플리케이션과 다른 시스템간의 상호작용을 한다.
  - web 어댑터(= 웹 컨트롤러), persistence 어댑터 등이 위치함
- 애플리케이션 계층
  - 바깥(Controller) 계층에서 호출하기 위해 반드시 거쳐야하는 곳.
  - 포트와 서비스를 포함합니다
    - 포트
      - 서비스에서 구현될 인터페이스
      - input port
        - incoming adapter에 의해 불려진다
      - output port
        - outgoing adapter를 호출
    - 서비스
      - 포트 구현체(= 유스케이스 구현체)
- 도메인 계층
    - 도메인 엔티티


#### 왜 이러한 아키텍처가 필요할까 ?
- 먼저 전통적인 3계층의 구조를 보자
`전통적인 3계층`
1. Presentation 
  - UI레이어
2. Domain 
    - 애플리케이션, 도메인
3. Data 

`알리스테어 콕번의 논의`
- User-side
    - UI 접근방법들
- Application
- Database-side
    - 뒤에서 표현한 무언가

  
> 각각의 역할이 담긴 Layer를 구분할 수 있는데 이러한 구분이 필요한 이유는.
   
- UI와 비즈니스 로직이 뒤섞이는 문제를 해결하기 위해
    - 화면 이동 버튼을 눌렀는데 카운트가 증가한다거나..
- 해결법은 계층형 아키텍처임
    - 하지만 기존 접근법은 User-side와 Database-side를 완전히 다른 것처럼 취급하는 경향이 있음.
    - 이들은 그저 Application의 외부로 취급하면 동일한 구조를 갖게 됨
    - 간단한 아웃풋으로 구성할 수 잇음.
- 애플리케이션 입장에선 그놈이 그놈

이렇듯 헥사고날 아키텍처를 잘 녹여낸다면 `애플리케이션과 어댑터는 포트로 연결되고 포트라는 인터페이스만 잘 사용하면 실제 그 너머에 있는 어댑터가 정확히 무엇인지 몰라도됨.`

또한
- Presentation -> Domain으로 연결할 때 사용하는 port를 incoming Port라고 부르고
- Domain -> Data로 연결할 때 사용하는 port는 Outgoing Port라고 부른다.


#### 요약
- 비즈니스 로직이나 도메인 로직이 엉키는것을 해결
테스트하고 쉽고 재사용하기 쉬움.
- UI 레이어에 비즈니스 로직이 없고
Application 레이어를 테스트하기 위해 모킹하고 있다면 이미 헥사고날 아키텍처를 사용하고 있다고 말할 수 있다.
- 여기서 한번 더 도메인 레이어를 분리해 애플리케이션 레이어는 포트에 집중하고 
  - 포트는 도메인 모델로 접근하는 진입점
- Domain Layer를 Mocking 같은 거 없이 **POJO**로 테스트하기 쉽고 재사용하기 좋은 객체의 세계로 만든다면 단일 프로그램의 아키텍처 이야기는 더이상 하지 않아도 충분


> 어댑터, 포트 등등의 용어가 새로이 등장했는데 이를 잘 파악하고 구분할 수 있게 적응해야할 것 같다.



### POJO란
- Plain Old Java Object. 
- 특정 원칙 집합을 준수하고 특별한 요구 사항이나 종속성이 없는 간단한 Java 클래스를 설명하는 데 사용되는 용어. 
- POJO는 종종 다양한 Java 프레임워크 및 아키텍처에서 데이터 개체 또는 엔터티로 사용한다.
- 특정 기술에 종속되지 않는 순수한 자바 객체를 의미한다.
  - 예를들어, 특정 기술을 사용하기 위해 특정 프레임워크를 의존하게되면 그것은 POJO라고 할 수 없다. )특정 기술에 종속되어있기 때문)
   
> 토비의 스프링 내용 : 진정한 POJO란 객체지향적인 원리에 충실하면서, 환경과 기술에 종속되지 않고 필요에 따라 재활용될 수 있는 방식으로 설계된 오브젝트다.
   

#### 특징
1. 단순성
  - 특정 프레임워크나 라이브러리를 확장하거나 구현하지 않는 평범하고 단순한 Java 클래스이다. 
  - 프레임워크별 주석 또는 종속성이 없어야 한다.

2. 캡슐화
  - 표준 Java 액세스 수정자(공용, 개인, 보호)를 사용하여 상태(필드) 및 동작(메서드)을 캡슐화한다. 
  - 내부 세부 정보를 숨기고 필요한 인터페이스만 노출하는 캡슐화 원칙을 따른다.

3. 직렬화 가능
  - 저장 또는 전송을 위해 객체를 바이트 스트림으로 변환할 수 있는 객체 직렬화를 지원하기 위해 직렬화 가능 인터페이스를 구현할 수 있다.

4. 기본 생성자
  - 일반적으로 인수가 없는 기본 생성자가 있으므로 "new" 키워드를 사용하여 쉽게 인스턴스화할 수 있다. 
  - Java의 생성자 오버로드 원칙에 따라 인수가 있는 추가 생성자를 제공할 수도 있다.

5. Getter 및 Setter 메서드
  - 종종 내부 상태(필드)에 액세스하고 수정하기 위한 getter 및 setter 메서드를 제공한다. 
  - 이러한 메서드는 JavaBean 명명 규칙을 따르므로 외부 구성 요소가 개체의 속성에 액세스하고 수정할 수 있다.


#### 요약
- 일반적으로 Java EE(Enterprise Edition) 프레임워크, DTO(데이터 전송 개체), ORM(Object-Relational Mapping) 프레임워크 및 기타 아키텍처 패턴을 비롯한 다양한 컨텍스트에서 사용된다.
- 쉽게 직렬화, 전송 및 지속 가능한 간단하고 가벼운 데이터 홀더 또는 엔터티 역할을 한다.


## 학습 키워드
- Hexagonal Architecture
- POJO
- [**조영호님의 “우아한객체지향” 세미나](https://youtu.be/dJ5C4qRqAgA)