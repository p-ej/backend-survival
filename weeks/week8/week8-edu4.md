# Aggregate

### Aggregate
- 일관성 및 트랜잭션 경계의 단일 단위로 취급되는 도메인 개체의 응집력 있는 클러스터이다. 
- 관련 엔터티 및 값 개체 그룹을 캡슐화하고 해당 경계 내에서 비즈니스 규칙 및 불변성을 적용한다.
- 도메인 개체를 응집력 있는 단위로 구조화하고 관리하는 데 사용되는 패턴
- 트랜잭션 일관성 경계를 정의하고 소프트웨어 애플리케이션의 도메인 계층 내에서 비즈니스 규칙을 시행하기 위한 중요한 개념

구성요소가 어떤건지에 대해
실제 집중하게될 것
타이어나 엔진같은 존재
우리의 비즈니스는 운송, 배달이다 
- 자동차라는 집합체를 사용하는 것과 같음 

우리는 Order라는 엔티티를 루트로 잡는다 (Aggregate)
트랜잭션을 통해 한번에 하나씩 


일관성 경계찾아 모델링
- 불변식이 오더를 중심
- 불변식의 이해 
- 트랜잭션적 일관성 경계와 동의어
작은 Aggregate으로 설계
ID로 다른 Aggretage를 참조 

주문바꾸기 수량이 유저 모델에 담은 상품 수량이 카운팅
유저 애그리거트 만들어야힘

나 여기 담았어 같은 도메인 이벤트를 날려서
아 그렇구나 그러면 내꺼 하나를 늘려줘
- 카운팅만 
결과적 일관성 1초 지나고나서 아까담은거 반영함 ㅋ


DDD(Domain-Driven Design)에서 Aggregate는 도메인 개체를 응집력 있는 단위로 구조화하고 관리하는 데 사용되는 패턴입니다. 이는 트랜잭션 일관성 경계를 정의하고 소프트웨어 애플리케이션의 도메인 계층 내에서 비즈니스 규칙을 시행하기 위한 중요한 개념입니다.

Aggregate는 일관성의 단일 단위로 취급되는 도메인 개체의 모음입니다. 하나 이상의 엔터티 및 값 개체로 구성되며 엔터티 중 하나는 집계 루트 역할을 합니다. Aggregate Root는 Aggregate에 대한 기본 액세스 지점 역할을 하며 Aggregate 내 개체의 일관성과 무결성을 유지 관리하는 역할을 합니다.

다음은 DDD의 집계와 관련된 몇 가지 주요 특성 및 원칙입니다.

1. 경계: Aggregate는 관련 도메인 개체의 클러스터 주위에 경계를 정의합니다. Aggregate 내의 엔터티 및 값 개체를 캡슐화하고 Aggregate에 대한 모든 수정 사항이 Aggregate Root를 통과하도록 합니다.

2. 일관성: Aggregate는 경계 내에서 불변성과 비즈니스 규칙을 적용하여 일관성을 보장합니다. 개체 생성, 업데이트 또는 삭제와 같이 Aggregate 상태에 영향을 미치는 모든 작업은 Aggregate Root를 통해 수행됩니다. 이렇게 하면 Aggregate가 변경 사항을 제어하고 유효성을 검사하여 Aggregate가 유효하고 일관된 상태로 유지되도록 할 수 있습니다.

3. 트랜잭션 경계: Aggregate는 트랜잭션 경계를 정의합니다. 즉, Aggregate 내의 변경 사항은 일반적으로 단일 작업 단위로 함께 유지되거나 롤백됩니다. 이는 Aggregate 내에서 데이터 무결성과 일관성을 유지하는 데 도움이 되며 데이터베이스 트랜잭션 관리를 단순화합니다.

4. Aggregate Root: 각 Aggregate에는 지정된 Aggregate Root가 있으며 이는 Aggregate 내의 개체에 액세스하고 수정하기 위한 진입점 역할을 하는 Aggregate 내의 엔터티입니다. Aggregate Root는 Aggregate 불변성을 적용하고 구성 객체 간의 상호 작용을 조정하는 역할을 합니다.

5. 관계 및 탐색: Aggregate 간의 관계는 일반적으로 Aggregate Roots에 대한 참조로 표현됩니다. 즉, 외부 세계는 Aggregate Roots를 통해서만 다른 Aggregate에 액세스하고 상호 작용할 수 있으므로 캡슐화를 유지하고 각 Aggregate의 일관성을 보호할 수 있습니다.

6. 수명 주기 관리: 집계에는 종종 잘 정의된 수명 주기와 생성 및 삭제 규칙이 있습니다. Aggregate 내에서 새 개체의 생성을 제어하고 사용하기 전에 일관된 상태인지 확인합니다.

집계는 관련 개체를 함께 그룹화하고 명확한 경계와 일관성 규칙을 정의하여 복잡한 도메인 모델을 구성하고 구조화하는 데 도움이 됩니다. 모듈화, 캡슐화를 가능하게 하고 도메인 개체가 애플리케이션의 도메인 계층 내에서 무결성을 유지하고 비즈니스 규칙을 시행하면서 효과적으로 협업하도록 돕습니다.


## 학습 키워드
- 집합체 (Aggregate)
- 불변식
- 트랜잭션적 일관성과 결과적 일관성