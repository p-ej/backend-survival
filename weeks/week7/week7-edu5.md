# Spring Data JPA


### Spring Data JPA란
- 애플리케이션의 데이터 액세스 계층 개발을 단순화하는 것을 목표로 하는 Spring Data 프로젝트의 일부이다. 
- JPA(Java Persistence API)를 사용하여 관계형 데이터베이스 작업을 위한 일련의 추상화 및 유틸리티를 제공한다.
- 데이터베이스 작업을 수행하기 위해 Spring Framework의 종속성 주입 및 트랜잭션 관리 기능을 JPA의 용이성과 결합한다. 
- 일반적으로 데이터 액세스에 필요한 상당한 양의 상용구 코드를 제거하여 개발자가 낮은 수준의 데이터베이스 상호 작용이 아닌 **비즈니스 로직**에 집중할 수 있도록 한다.

#### 특징
1. 레포지토리 추상화
  - 엔터티에 대한 공통 데이터 액세스 작업(CRUD 작업)을 정의하는 인터페이스인 리포지토리 개념을 도입했다. 
  - 적절한 Spring Data JPA 인터페이스를 확장함으로써 개발자는 엔터티 저장, 업데이트, 삭제 및 쿼리와 같은 일반적인 데이터베이스 작업에 대해 미리 정의된 메서드를 활용할 수 있다.

2. 쿼리 방법
  - 개발자가 단순히 메서드 서명을 선언하여 리포지토리에서 쿼리 메서드를 정의할 수 있다. 
  - 메서드 이름은 특정 명명 규칙을 따르며 Spring Data JPA는 메서드 이름과 매개변수를 기반으로 필요한 SQL 쿼리를 자동으로 생성한다. 
    - 이 접근 방식은 명시적인 SQL 문을 작성하지 않고 쿼리를 표현하는 편리한 방법을 제공한다.

3. 페이지 네이션 및 정렬
  - 페이지 네이션 및 정렬에 대한 기본 제공 지원을 제공한다. 
  - 개발자는 'Pageable' 또는 'Sort' 개체를 메서드 매개변수로 전달하여 쿼리 결과를 쉽게 페이지로 나누고 정렬 기준을 지정할 수 있다. 
  - 기본 SQL 생성 및 데이터 검색을 처리하여 페이지가 매겨진 API의 구현을 단순화한ㄷ.

4. 자동 쿼리 생성
  - 정의된 리포지토리 메서드를 기반으로 SQL 쿼리를 자동으로 생성한다. 
  - 메서드 이름을 사용한 동적 쿼리 생성과 더 복잡한 쿼리에 대한 쿼리 주석 지원을 지원한다. 
    - 이렇게 하면 수동 SQL 문을 작성할 필요성이 줄어들고 개발 생산성이 향상된다.

5. 트랜잭션 관리
  - Spring Framework의 트랜잭션 관리 기능과 원활하게 통합된다. 
  - 선언적 트랜잭션 지원을 제공하여 개발자가 트랜잭션 주석을 사용하여 리포지토리 메서드 또는 서비스 계층 메서드에 주석을 달 수 있다. 
  - 이렇게 하면 데이터베이스 작업을 수행할 때 일관성과 데이터 무결성이 보장된다.

6. Spring 생태계와의 통합
  - Spring Boot, Spring MVC 및 Spring Security와 같은 Spring 생태계의 다른 구성 요소와 잘 통합된다. 
  - Spring의 구성 및 종속성 주입 기능을 활용하여 쉬운 통합 및 모듈식 개발을 가능하게 한다.


> - 전반적으로 Spring Data JPA는 높은 수준의 추상화 및 생산성 향상 기능을 제공하여 데이터 액세스 계층의 개발을 단순화한다.
> - JPA와 Spring Framework의 기능을 결합하여 데이터베이스 작업을 간소화하고 상용구 코드를 줄이며 Java 애플리케이션에서 개발자 생산성을 향상시킨다.


### Dao와 Repository차이
- DAO(Data Access Object)와 리포지토리는 애플리케이션에서 데이터 액세스 계층을 구현하는 데 사용되는 패턴 또는 접근 방식이다. 
- 비슷한 목적을 수행하지만 DAO와 리포지토리 간에는 몇 가지 차이점이 있다.

#### 특징
1. 목적
    - `DAO`
      - 패턴은 데이터베이스나 웹 서비스와 같은 특정 데이터 소스에 액세스하는 저수준 세부 정보를 캡슐화하고 추상화하는 방법을 제공하는 데 중점을 둔다
      - 데이터 원본에서 CRUD(만들기, 읽기, 업데이트, 삭제) 작업을 수행하기 위한 일관된 인터페이스를 제공한다.
    - `Repository`
      - 개체/엔티티 모음을 나타내는 상위 수준 추상화를 제공하고 해당 개체를 쿼리하고 조작하는 방법을 제공하는 것을 목표로 한다. 
      - 일반적으로 DDD(도메인 기반 디자인)의 도메인 또는 집계 개념과 관련이 있다.

2. 추상화 수준
    - `DAO`
      - 일반적으로 기본 데이터 소스에 더 가깝고 데이터베이스 관련 작업을 처리한다. 
      - 여기에는 SQL 쿼리 작성 또는 특정 데이터베이스 API 호출이 포함될 수 있다.
    - `Repository`
      - 특정 데이터 소스가 아닌 도메인 개체/엔티티에 초점을 맞춤으로써 더 높은 수준의 추상화를 제공한다. 
      - 데이터 저장 방법에 대한 세부 정보를 추상화하고 도메인 개체 작업을 위한 방법을 제공한다.

3. 개체 매핑
    - `DAO`
      - 개발자는 종종 데이터베이스 스키마와 도메인 개체 자체 간의 매핑을 처리해야 한다. 
      - 여기에는 데이터베이스 레코드를 개체 인스턴스에 매핑하는 코드를 수동으로 작성하는 작업이 포함될 수 있다.
    - `Repository`
      - 종종 JPA의 경우 Hibernate와 같은 ORM(개체 관계형 매핑) 프레임워크를 활용하여 데이터베이스 테이블과 도메인 개체/엔티티 간의 매핑을 처리한다. 
      - 매핑은 일반적으로 주석 또는 XML 매핑 파일을 통해 구성된다.

4. 세분성
    - `DAO`
      - ID로 개체 찾기, 사용자 지정 쿼리 실행 또는 개별 개체 저장/업데이트와 같은 특정 데이터 액세스 작업에 대한 방법을 제공하는 데 중점을 둔다.
    - `Repository`
      - 개체 컬렉션 작업을 위한 보다 응집력 있고 높은 수준의 인터페이스를 제공한다. 
      - 특정 기준에 따라 개체를 쿼리하고, 대량 작업을 수행하고, 개체의 수명 주기를 관리하는 메서드를 노출하는 경우가 많다.

5. 도메인 중심 설계
    - `DAO` 
      - 일반적으로 애플리케이션의 도메인 모델에 직접 연결되지 않는다. 
      - 데이터 액세스의 기술적 측면에 더 중점을 두고 도메인별 개념에 구애받지 않는다.
    - `Repository`
      - 응용 프로그램의 도메인 또는 집계 디자인에 정의된 도메인 모델 및 개념과 일치하도록 설계되었다. 
      - 도메인 개체 검색 및 유지와 관련된 논리를 캡슐화한다.


> - DAO와 리포지토리라는 용어는 때때로 같은 의미로 사용되며 특정 구현은 애플리케이션에서 사용되는 프레임워크 또는 아키텍처 스타일에 따라 다를 수 있다. 
> - Java 및 Spring과 같은 프레임워크의 맥락에서 "Repository"라는 용어는 종종 데이터 액세스에 대한 상위 수준 추상화를 제공하는 Spring Data JPA와 연관되는 반면 "DAO"라는 용어는 보다 일반적인 경우나 사용자 정의 구현에서 사용될 수 있다.

   
   
### JPA Repository와 DDD의 Repository
- 유사한 목적을 제공하지만 다른 컨텍스트에서 작동하는 서로 다른 두 가지 개념이다.

#### JPA Repository
- JPA(Java Persistence API) 및 Spring Data JPA와 같은 널리 사용되는 프레임워크에서 제공하는 리포지토리 인터페이스를 나타낸다. 
- JPA 기반 애플리케이션에 대한 데이터 액세스 및 지속성 작업을 단순화하는 추상화이다.

`특징`
- JPA 저장소 인터페이스는 엔티티에 대한 공통 CRUD(만들기, 읽기, 업데이트, 삭제) 작업을 위해 미리 정의된 메서드 집합을 제공한다. 
- 인터페이스를 확장하여 명시적 쿼리나 상용구 코드를 작성하지 않고도 기본 데이터 액세스 기능을 상속할 수 있다. 
- JPA Repository는 일반적으로 기본 JPA 구현(예: Hibernate)을 활용하여 개체 관계형 매핑 및 데이터베이스 상호 작용을 처리한다

> 사용 예
```java
public interface UserRepository extends JpaRepository<User, Long> {
    List<User> findByLastName(String lastName);
}
```
- `UserRepository`는 `JpaRepository` 인터페이스를 확장하고 추가 사용자 지정 쿼리 메서드를 제공한다. 
- Spring Data JPA와 함께 JPA 구현은 메서드 이름 및 주석을 기반으로 필요한 SQL 쿼리를 생성한다.

#### DDD의 Repository
- 도메인 개체 또는 집계의 컬렉션을 나타내고 이러한 개체에 액세스하고 유지할 수 있는 방법을 제공하는 패턴이다. 
- 도메인 계층의 일부이며 도메인 모델과 데이터 지속성 계층 간의 중개자 역할을 한다.
- 주요 책임은 데이터 액세스 세부 정보를 추상화하고 도메인 개체 작업을 위한 깔끔한 인터페이스를 제공하는 것이다. 
- Repository라는 도메인의 불변성과 비즈니스 규칙을 준수하면서 집계/엔티티를 검색, 저장 및 쿼리하기 위한 논리를 캡슐화한다.

> DDD의 Repository는 도메인 모델의 개념에 맞게 설계되었으며 일반적으로 인프라 관련 문제와는 별도로 도메인 계층 내에서 정의된다.
   
   
> 사용예
```java
public interface OrderRepository {
    Order findById(UUID orderId);
    List<Order> findByCustomer(Customer customer);
    void save(Order order);
    void delete(Order order);
}

```
- `OrderRepository`는 도메인에 특정한 메서드를 정의하고 `Order` 엔터티 작업을 위한 계약을 제공한다. 
- Repository 구현은 데이터 액세스 및 지속성에 대한 세부 정보를 처리하여 도메인 개체가 올바르게 저장되고 검색되도록 한다.

> - 요약하면 JPA 저장소는 JPA 프레임워크에서 제공하는 저장소 인터페이스의 특정 구현이며 JPA를 사용한 데이터 액세스 및 지속성 작업에 중점을 둔다. 
> - 반면 DDD의 Repository는 집계/엔티티와의 상호 작용을 추상화하는 도메인 계층 내의 개념으로, 도메인 모델이 특정 데이터 액세스 기술이나 프레임워크에 묶이지 않고 개체와 함께 작동할 수 있도록 한다.


### Spring AOP
- 관점 지향 프로그래밍
- Spring AOP(Aspect-Oriented Programming)는 애플리케이션에서 교차 절단 문제를 모듈화할 수 있는 프로그래밍 패러다임이다.
- 로깅, 인증, 트랜잭션 관리 및 오류 처리와 같이 코드베이스의 여러 부분을 가로지르는 공통 기능을 분리하고 관리하는 방법을 제공한다.

`기존의 객체 지향 프로그래밍에서는 일반적으로 비즈니스 로직 내에서 이러한 교차 절단 문제를 직접 구현하여 코드 중복 및 모듈성 감소로 이어진다. Spring AOP는 핵심 비즈니스 로직을 수정하지 않고 애플리케이션의 여러 부분에 적용할 수 있는 동작의 모듈 단위인 aspect 개념을 도입하여 이 문제를 해결한다.`

#### 특징
1. Aspect: Aspect는 교차 편집 문제를 캡슐화하는 동작의 모듈 단위이다. 수행해야 할 작업과 적용 시기를 정의한다.

2. 조인 포인트: 조인 포인트는 메서드 호출 또는 예외 발생과 같이 애플리케이션 실행 중 특정 지점이다. 동작을 추가하기 위해 이러한 조인 포인트에 측면을 적용할 수 있다.

3. Advice: 
  - 실제 구현이다. 
  - 특정 조인 포인트에서 적용되어야 하는 동작을 정의한다. 
  - 어드바이스의 일반적인 유형에는 "이전" 어드바이스(조인 포인트 이전에 실행됨), "이후" 어드바이스(조인 포인트 이후에 실행됨, 결과에 관계 없음) 및 "주변" 어드바이스(조인 포인트를 래핑하여 사용자 정의 동작을 허용함)가 포함된다. 실행 후).

4. Pointcut
  - pointcut은 어떤 조인 포인트가 aspect에 의해 일치되어야 하는지를 지정하는 술어이다. 
  - 어드바이스가 적용되어야 하는 조인 포인트를 선택하기 위한 기준을 정의한다. 
    - 예를 들어 특정 클래스의 모든 메서드 또는 특정 주석이 있는 모든 메서드와 일치하도록 pointcut을 정의할 수 있다.

5. 위빙
  - 위빙은 코드에 aspect를 적용하는 과정이다. 
  - 컴파일 타임, 로드 타임 또는 런타임에 수행할 수 있다. 
  - Spring AOP는 애플리케이션 실행 중에 aspect가 동적으로 적용되는 런타임 위빙을 주로 사용한다.

#### 요약
- Spring AOP는 Spring 프레임워크와 통합되어 Spring 관리 빈에 aspect를 적용하는 방법을 제공한다. 
- Aspect, Pointcuts 및 Advice를 정의하기 위해 XML 및 주석 기반 구성을 모두 지원한다. 
- 핵심 비즈니스 로직과 별도로 교차 편집 문제를 모듈화하고 관리할 수 있으므로 코드 모듈성, 재사용성 및 유지 관리성이 향상된다.

> Spring AOP의 사용 사례에는 로깅 메서드 호출, 트랜잭션 처리, 결과 캐싱, 메서드에 대한 액세스 보안 및 애플리케이션 전체에서 균일한 예외 처리가 포함된다.
   
> 전반적으로 Spring AOP는 모듈식 및 재사용 가능한 방식으로 교차 절단 문제를 구현하여 보다 깨끗하고 유지 관리 가능한 코드를 촉진하는 강력한 매커니즘이다.


### @Transactional 어노테이션
- 메서드 또는 클래스를 트랜잭션으로 구분하는 데 사용되는 Spring Framework에서 제공하는 기능이다. 
- 데이터베이스 작업 또는 다른 유형의 트랜잭션 동작을 포함하는 Spring 애플리케이션에서 일반적으로 사용된다.
- 주석이 메서드나 클래스에 적용되면 Spring 프레임워크에 특정 메서드나 클래스에 대한 트랜잭션을 관리하도록 지시한다. 
- 트랜잭션 시작 및 커밋(또는 롤백)을 포함하여 트랜잭션 경계를 자동으로 관리할 수 있다.


#### 특징 및 사용법
1. 트랜잭션 관리
  - `@Transactional`로 메서드나 클래스에 주석을 달아 Spring은 주석이 달린 코드에 대한 트랜잭션 컨텍스트를 설정한다. 
  - 코드가 트랜잭션 내에서 실행되도록 하고 예외가 발생하면 데이터 일관성을 유지하기 위해 트랜잭션을 롤백할 수 있다.

2. 메서드 수준
  - `@Transactional`은 각 메서드가 트랜잭션 컨텍스트 내에서 실행되어야 함을 지정하여 개별 메서드에 적용할 수 있다.
  - 서로 다른 메서드가 서로 다른 트랜잭션 동작을 가질 수 있으므로 트랜잭션 경계를 세밀하게 제어할 수 있다.

3. 클래스 수준
  - `@Transactional`은 클래스 수준에서도 적용할 수 있다. 
  - 이 경우 해당 클래스 내의 모든 메서드는 기본적으로 트랜잭션으로 간주된다. 
  - 그러나 특정 메서드에 다른 트랜잭션 동작이 필요한 경우 메서드 수준 주석이 클래스 수준 주석을 재정의할 수 있다.

4. 트랜잭션 전파
  - 동일한 실행 컨텍스트 내에서 여러 트랜잭션 메서드가 호출될 때 트랜잭션이 전파되는 방식을 제어하는 옵션을 제공한다. 
  - 전파 필요, 새 요구, 중첩 등과 같은 전파 동작을 정의할 수 있다.

5. 트랜잭션 매개변수
  - 트랜잭션 동작을 사용자 정의하기 위한 추가 매개변수를 지원한다. 
  - 이러한 매개변수에는 격리 수준, 읽기 전용 상태, 롤백 규칙 및 시간 초과 설정이 포함된다.

6. 구성
  - 사용하려면 Spring 애플리케이션 컨텍스트에서 적절한 트랜잭션 관리자를 구성해야 한다. 
  - 트랜잭션 관리자는 트랜잭션 시작, 커밋 또는 롤백과 같은 실제 트랜잭션 동작을 처리한다.

   
#### 요약
- `@Transactional`을 사용하면 Spring 애플리케이션에서 트랜잭션 관리를 단순화할 수 있다. 
- 수동 트랜잭션 처리 코드의 필요성을 제거하고 상용구 코드를 줄이며 트랜잭션 관리에 대한 선언적이고 일관된 접근 방식을 촉진한다.



> `@Transactional`은 일반적으로 `PlatformTransactionManager` 및 트랜잭션 경계의 적절한 구성과 같은 Spring의 트랜잭션 관리 기능과 함께 사용된다는 점에 유의하는 것이 중요하다. 
   
> JDBC, JPA 및 Hibernate와 같이 Spring에서 지원하는 다양한 데이터 액세스 기술과 원활하게 작동한다.


## 학습 키워드
- Spring Data JPA
- Dao 와 Repository차이
- JPA Repository와 DDD의 Repository
- Spring AOP
- @Transactional